5. Other user interactions
In an SPA, we also want the ability to track other page interactions and update the page accordingly. A typical example would be a menu of choices that swaps out different parts of the page.

Let’s modify our app to offer dictionary or thesaurus functionality.

Copy app-4.html to app-5a,html, app-4.js to app-5a.js and update app-5a.html to load app-5a.js.
public/app-5a.html
<!DOCTYPE html>
<html>

<head>
    <title>A Simple SPA</title>
    <link
        href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAOjv4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEBEAAAAAEBAAABAQAAAQEREREBAAABEREREREAAAARAREBEAAAAAEREREAAAAAABAAEAAAAAAAEAAQAAAAAAEAAAEAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AAD//wAA//8AAPyfAADr6wAA6AsAAOADAADyJwAA+A8AAP3fAAD93wAA++8AAP//AAD//wAA"
        rel="icon" type="image/x-icon" />                    
</head>

<body>
<!-- Add a navigation menu.
     Notice the URL for links are prefixed by a `#`.
     It is normally used to point to a specific part of a page.
     This means that the browser will look on the page instead of making a new page request.
     We can use this to capture the change in the location and swap out parts as we want.  -->
    <nav>
        <a href="#/dictionary">Dictionary</a>
        <a href="#/thesaurus">Thesaurus</a>
    </nav>

    <br/>
    <div id="app"></div>

    <script id="template" type="text/handlebars-template">
        <h2>{{word}} &nbsp; {{phonetic}}</h2>                                     
        <h3>Meanings</h3>
        <h4>{{partOfSpeech}}</h4>
        <ol>
            {{#each definitions}}
                <li>{{this.definition}}
            {{/each}}
        </ol>
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>
    
<!-- We are going to use the ES6 module system because the code accumulating in a single file
     is becoming unwieldy.  So, we specify that the script is a module script.  -->
    <script src="/js/app-5a.js"></script> 
</body>

</html>
Basic routing
Now let’s progressively add in functionality to handle the menu.

Because this involves changing the location URL in browser by altering what comes after the , this is also known as routing. For example, we want to route the user from http://localhost:5050/index.html/dictionary to http://localhost:5500/index.html#/thesaurus.

Handling route changes
There are 2 ways that the route can change. The first is if the user clicks on a link with a different route such as in the navigation links above. The second is that the user can type in route in the address bar itself.

public/js/app-5a.js
window.addEventListener('load', router);                        
window.addEventListener('hashchange', router);                  
Previously, we handled all the logic in the load event of the window. This time, we delegate the window loading to the router. Note we have not yet written the router. The router should figure out what to display on the page when the app is loaded by entering a URL in the browser.
We also want the router to handle event when the # changes. Conveniently, there is such an event :-)
Wiring the router
In index.js add in an array of routes that we specified in the navigation.

public/js/app-5a.js
const routes = [                                                                        
  { path: "/dictionary", handler: dictionaryRouteHandler },                             
  { path: "/thesaurus", handler: thesaurusRouteHandler }                                
];

const router = () => {                                                                  
  const path = location.hash.slice(1).toLowerCase() || '/';                             
  const { handler = defaultRouteHandler } = routes.find(r => r.path == path) || {};     
  handler();                                                                            
};
First we need to declare our routes and what functions to call when we change the route. The simplest option is to store a list of paths and functions in an array.
dictionaryRouteHandler is a function that we have not written yet. Its intention is to handle the dictionary functionality - render the HTML and handle the form interaction.
Ditto for handling the thesaurus route.
Here’s our router function that we wired into the window events. It’s all of 3 lines :-)
We get the path from the location in the browser’s address field. Conveniently, the location object has a hash string property and we can take the slice after the #, and convert to lowercase. If we can’t find the hash for whatever reason, just default the path to '/'.
Now we find the route in the routes array by matching the path from location.hash with what we declared in the routes array. If we can’t find anything in the array then return {} - an empty object. Also, we are using destructuring assignment with a default value {handler = defaultRouteHandler}. Remember, that routes.find() will return an object from the routes array as { path: '…​', handler: …​}. The destructuring assignment looks for handler in the object returned from routes.find() and creates a local variable called handler (implicitly) and assigns it the value of the handler property from the object. If it can’t find the handler property, then still go ahead and create a local variable handler and assign it a value of defaultRouteHandler. Note we have not yet written defaultRouteHandler.
Now that we have the handler associated with the route, just invoke it and let it do whatever it needs.
These are a just a few lines of code but incredibly rich. There is a lot happening so far. Make sure you get the gist of it before continuing. Everything after this is more or less what we did before.
Routing functions
We’ve cooked up the basic functionality of the router and we have enough to check if it works.

public/js/app-5a.js
const defaultRouteHandler = () => console.log("No route found! Using the default!");
const dictionaryRouteHandler = () => console.log("Dictionary!");
const thesaurusRouteHandler = () => console.log("Thesaurus!");
If you run the app and click on the navigation bar, then you should see the above messages in the console.

Great! It’s time to write those routing functions.

public/js/app-5a.js
const defaultRouteHandler = () => {                                           
  document.getElementById('app').innerHTML = '<p>Click on a menu item.</p>'
};

const thesaurusRouteHandler = () => {                                         
  document.getElementById('app').innerHTML = `
          <h1>Thesaurus</h1>
          <p>Coming soon!</p>
          <br/>`;
};

const dictionaryRouteHandler = () => {                                        
  document.getElementById('app').innerHTML =  `
    <h1>Dictionary</h1>
    <br/>
    <form id="lookup-form"> 
      <input name="word" type="text" required/>
      <input name="submit" type="submit" value="Lookup"/>
    </form>
    <br/>
    <div id="results"></div>`;
  lookupWord();                                                                       
};
The defaultRouteHandler simply updates the app div with a message to click on a menu item.
The thesaurusRouteHandler updates the DOM directly with some text that says that this functionality is coming soon.
The dictionaryRouteHandler has to do a bit more than the others. It must first update the DOM to display the form for the word lookup. Then it calls lookupWord() to handle the form interaction.
The lookupWord() function is basically the same function we wrote to handle the form. The only difference is that it updates a different node in the DOM being results which is part of the HTML in dictionaryRouteHandler.

public/js/app-5a.js
function lookupWord() {                                                        
    const form = document.getElementById("lookup-form");
    form.addEventListener("submit", (event) => {
        event.preventDefault();

        const data = new FormData(event.target);
        const word = data.get("word");

        const options = {
            method: 'GET',
        };

        document.getElementById('results').innerHTML = `<p>Searching for <em>${word}'</em>...</p>`;

        fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`, options)
            .then(response => response.json())
            .then(data => {
                data = {
                    word: data[0].word,
                    phonetic: data[0].phonetic,
                    partOfSpeech: data[0].meanings[0].partOfSpeech,
                    definitions: data[0].meanings[0].definitions
                };
                const template = document.getElementById('template').innerText;
                const compiledFunction = Handlebars.compile(template);
                document.getElementById('results').innerHTML = compiledFunction(data);
            });
    });;
}
Run the app and confirm that everything runs as expected.

Using a routing library
Our router is incredibly trivial. It’s value is in learning how to build a basic router from first principles. A more robust router should honour the back button (i.e. history) behaviour of a browser, better error handling, support different browsers, etc.

Let’s try out Vanilla Router. We won’t install it using the node.js tools, and simply load it from a CDN directly into our page, just as we did with Handlebars.

The other problem is that we are back to using strings for HTML fragments. Let’s switch those to templates as well.

Copy app-5a.html to app-5b,html, app-5a.js to app-5b.js and update app-5b.html to load app-5b.js.
public/app-5a.html
<!DOCTYPE html>
<html>

<head>
    <title>A Simple SPA</title>
    <link
        href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAOjv4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEBEAAAAAEBAAABAQAAAQEREREBAAABEREREREAAAARAREBEAAAAAEREREAAAAAABAAEAAAAAAAEAAQAAAAAAEAAAEAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AAD//wAA//8AAPyfAADr6wAA6AsAAOADAADyJwAA+A8AAP3fAAD93wAA++8AAP//AAD//wAA"
        rel="icon" type="image/x-icon" />
</head>

<body>
    <nav>
        <a href="#/dictionary">Dictionary</a>
        <a href="#/thesaurus">Thesaurus</a>
    </nav>

    <br />
    <div id="app"></div>

    <script id="default-template" type="text/handlebars-template">
        <p>Click on menu item.</p>
    </script>

    <script id="dictionary-template" type="text/handlebars-template">
        <h1>Dictionary</h1>
        <br/>
        <form id="lookup-form"> 
        <input name="word" type="text" required/>
        <input name="submit" type="submit" value="Lookup"/>
        </form>
        <br/>
        <div id="results"></div>
    </script>

    <script id="thesaurus-template" type="text/handlebars-template">
        <h1>Thesaurus</h1>
        <p>Coming soon!</p>
        <br/>
    </script>

    <script id="results-template" type="text/handlebars-template">
        <h2>{{word}} &nbsp; {{phonetic}}</h2>                                     
        <h3>Meanings</h3>
        <h4>{{partOfSpeech}}</h4>
        <ol>
            {{#each definitions}}
                <li>{{this.definition}}
            {{/each}}
        </ol>
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>

    <!-- the vanilla-router library-->
    <script src="https://cdn.jsdelivr.net/npm/vanilla-router@1.2.8/index.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

    <script src="/js/app-5b.js"></script>
</body>

</html>
Take a moment to read the templates. These are standard Handlebars templates.

Including the jQuery library.
Also, notice that we are now using the jQuery library. JQuery is a convenient library that allows us to query and update the DOM. It saves us from the tedious low-level document.getElement…​ code.

For now, know that jQuery provides a global function $(…​). Using $(), we can find anything in the DOM and update it too.

For more info, look at the jQuery tutorials. For the code below, though, we will explain what’s going on.

Update app-5b.js with the following code. Note that you can delete all the router code we had previously, except the lookupWord() function. We will still use that function.

/public/js/app-5b.js
window.addEventListener('load', () => {
  const app = $('#app');                                                                    

  const defaultTemplate = Handlebars.compile($('#default-template').html());                
  const dictionaryTemplate = Handlebars.compile($('#dictionary-template').html());
  const thesaurusTemplate = Handlebars.compile($('#thesaurus-template').html());

  const router = new Router({                                                               
    mode:'hash',                                                                            
    root:'app-5b.html',                                                                     
    page404: (path) => {                                                                    
      const html = defaultTemplate();                                                       
      app.html(html);
    }
  });

  router.add('/dictionary', async () => {                                                    
    html = dictionaryTemplate();
    app.html(html);
    lookupWord();
  });

  router.add('/thesaurus', async () => {                                                      
    html = thesaurusTemplate();
    app.html(html);
  });

  router.addUriListener();                                                                    

  $('a').on('click', (event) => {                                                             
    event.preventDefault();                                                                   
    const target = $(event.target);
    const href = target.attr('href');                                                         
    const path = href.substring(href.lastIndexOf('/'));
    router.navigateTo(path);                                                                  
  });

  router.navigateTo('/');                                                                     
});
Use jQuery to find the div with the id of app. jQuery uses the convention of #id to tell it to search by id.
We pre-compile all the templates for the different routes we need. Again, use jQuery to get the DOM element by id, and as the resulting object for it’s html - $(#default-template).html(). Nice!
Let’s use the vanilla-router. Create a new router.
Tell it to use hash mode. See the library docs for the difference between hash and 'history' modes.
Tell it to use app-5rb.html as the root for all URL’s. The router takes full control of the location and not specifying a root will destroy and relative route in place.
The router offers us a way to handle routes that cannot be found. We just update the DOM to show the HTML from the default template. Remember that app is an object that jQuery returned. It has a convenient method html(…​) to update it’s inner HTML.
Declare a new route for the router for the dictionary. Simply render the template and let lookupWord() handle the rest.
This is the route handler for the thesaurus.
This tells the router to handle changes to the URI.
jQuery goodness again. Here we tell jQuery to find all a elements in the DOM and attach a function to the click event for each of them, however many there are. We could be more specific and tell jQuery to only do this for the a nodes in the nav tree.
We get the href value from the link that was clicked.
Convert it to a path and tell the router to navigate to it.
Finally, tell the router to navigate to '/' which is an unhandled route that will show the message to click on a menu item.
Run the app and notice how the URL in the location bar is controlled by the router.

For convenience, here’s the complete app-5b.js file with the lookupWord() function.

/public/js/app-5b.js
function lookupWord() {                                                        
    const form = document.getElementById("lookup-form");
    form.addEventListener("submit", (event) => {
        event.preventDefault();

        const data = new FormData(event.target);
        const word = data.get("word");

        const options = {
            method: 'GET',
        };

        document.getElementById('results').innerHTML = `<p>Searching for <em>${word}'</em>...</p>`;

        fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`, options)
            .then(response => response.json())
            .then(data => {
                data = {
                    word: data[0].word,
                    phonetic: data[0].phonetic,
                    partOfSpeech: data[0].meanings[0].partOfSpeech,
                    definitions: data[0].meanings[0].definitions
                };
                const template = document.getElementById('results-template').innerText;
                const compiledFunction = Handlebars.compile(template);
                document.getElementById('results').innerHTML = compiledFunction(data);
            });
    });;
}

// tag::router[]
window.addEventListener('load', () => {
  const app = $('#app');                                                                    

  const defaultTemplate = Handlebars.compile($('#default-template').html());                
  const dictionaryTemplate = Handlebars.compile($('#dictionary-template').html());
  const thesaurusTemplate = Handlebars.compile($('#thesaurus-template').html());

  const router = new Router({                                                               
    mode:'hash',                                                                            
    root:'app-5b.html',                                                                     
    page404: (path) => {                                                                    
      const html = defaultTemplate();                                                       
      app.html(html);
    }
  });

  router.add('/dictionary', async () => {                                                    
    html = dictionaryTemplate();
    app.html(html);
    lookupWord();
  });

  router.add('/thesaurus', async () => {                                                      
    html = thesaurusTemplate();
    app.html(html);
  });

  router.addUriListener();                                                                    

  $('a').on('click', (event) => {                                                             
    event.preventDefault();                                                                   
    const target = $(event.target);
    const href = target.attr('href');                                                         
    const path = href.substring(href.lastIndexOf('/'));
    router.navigateTo(path);                                                                  
  });

  router.navigateTo('/');                                                                     
});
// end::router[]
